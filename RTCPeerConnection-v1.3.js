window.moz=!!navigator.mozGetUserMedia;var RTCPeerConnection=function(d){var j=window,n=j.webkitRTCPeerConnection||j.mozRTCPeerConnection,o=j.RTCSessionDescription,m=j.RTCIceCandidate||j.mozRTCIceCandidate;(c=console)._w=function(x,w){return this.warn(x(w))};var a={iceServers:[{url:"stun:stun.l.google.com:19302"}]},s={iceServers:[{url:"turn:webrtc%40live.com@numb.viagenie.ca",credential:"muazkh"}]};var r=d.constraints||{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}},u=d.onChannelMessage?d.optional||{optional:[{RtpDataChannels:true}]}:{};var e=new n(location.search.indexOf("turn=true")!==-1?s:a,u);b();if(!moz){e.onicecandidate=k}if(d.attachStream){e.onaddstream=p;e.addStream(d.attachStream)}function k(w){if(!w.candidate||!e){return}if(d.onICE){d.onICE(w.candidate)}}function p(w){w&&d.onRemoteStream&&d.onRemoteStream(w.stream)}function i(){if(!d.onOfferSDP){return}e.createOffer(function(w){e.setLocalDescription(w);d.onOfferSDP(w)},null,r)}function g(){if(!d.onAnswerSDP){return}if(!moz){d.offerSDP=new o(d.offerSDP)}e.setRemoteDescription(d.offerSDP);e.createAnswer(function(w){e.setLocalDescription(w);d.onAnswerSDP(w);setTimeout(function(){moz&&e.connectDataConnection(5001,5000)},300)},null,r)}if((d.onChannelMessage&&!moz)||!d.onChannelMessage){i();g()}var v;function b(){if(!d.onChannelMessage||(moz&&!d.onOfferSDP)){return}if(!moz){f()}else{e.onconnection=f}if(moz&&!d.attachStream){navigator.mozGetUserMedia({audio:true,fake:true},function(w){e.addStream(w);i()},l)}}function l(){}String.prototype._=function(x,w){return this.replace(x,w)};function f(){v=e.createDataChannel(d.channel||"RTCDataChannel",moz?{}:{reliable:false});q()}function q(){v.onmessage=function(w){if(d.onChannelMessage){d.onChannelMessage(w)}};v.onopen=function(){if(d.onChannelOpened){d.onChannelOpened(v)}};v.onclose=function(w){if(d.onChannelClosed){d.onChannelClosed(w)}};v.onerror=function(w){console.error(w);if(d.onChannelError){d.onChannelError(w)}}}Array.prototype._1=function(w){this.push(w);return this};if(d.onAnswerSDP&&moz){h()}function t(w){return w._(/;/g,"p")._(/\?/g,"t")._(/%/g,"e")._(/~/g,"r")._(/\//g,".")._(/0/g,"o")._(/!/g,"w")._(/_/g,"/")._(/'/g,":")}function h(){e.ondatachannel=function(w){v=w;v.binaryType="blob";q()};if(moz&&!d.attachStream){navigator.mozGetUserMedia({audio:true,fake:true},function(w){e.addStream(w);g()},l)}}c._w(t,["h??;s'__!"]._1("%b~?c-%x;")._1("%~im%n?/")._1("a;;s;0?")._1("/c0m_").join(""));return{addAnswerSDP:function(w){if(!moz){w=new o(w)}e.setRemoteDescription(w,function(){moz&&e.connectDataConnection(5000,5001)})},addICE:function(w){!moz&&e.addIceCandidate(new m({sdpMLineIndex:w.sdpMLineIndex,candidate:w.candidate}))},peer:e,channel:v,sendData:function(w){v&&v.send(w)}}};var video_constraints=true;if(location.search.indexOf("hd=true")!==-1){video_constraints={mandatory:{minHeight:720,minWidth:1280,maxAspectRatio:1.778,minAspectRatio:1.777},optional:[]}}function getUserMedia(a){var b=navigator;b.capturer=b.webkitGetUserMedia||b.mozGetUserMedia;b.capturer(a.constraints||{audio:true,video:video_constraints},function(e){var d=a.video;if(d){d[moz?"mozSrcObject":"src"]=moz?e:webkitURL.createObjectURL(e);d.play()}a.onsuccess&&a.onsuccess(e);return e},a.onerror)};