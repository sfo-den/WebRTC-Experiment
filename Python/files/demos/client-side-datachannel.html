<title>Simple Chat Demo using RTCDataChannel APIs ® Muaz Khan</title>
<h1 style="padding: .5em 1em;text-align: center;">Simple Chat Demo using RTCDataChannel APIs</h1>

<meta name="description" content="A simple one-page Chat Demo using RTCDataChannel APIs.">
<link rel="author" type="text/html" href="https://plus.google.com/100325991024054712503">
<meta name="author" content="Muaz Khan">

<style>@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: 300; src: local('Open Sans Light'), local('OpenSans-Light'), url(/images/font.woff) format('woff'); } html { background: #ECECEC; font-family: 'Open Sans'; } body { color: #333; font: 1.4em 'Open Sans' , arial, sans-serif; font-weight: 300; line-height: 1.5; margin: 0 3em; background: white; border: 1px dotted #BBA9A9; border-top: 0; } h1, h2 { color: #2778ec; font-size: 1.6em; font-weight: 300; line-height: 1.15; }  a { display: inline-block; padding: 0.2em; color: #1B75C9; text-decoration: none; border-bottom: 1px dotted #0085FF; margin: 0 .2em; } a:hover { color: red; }tr, td, th{vertical-align: top;padding: .7em 1.4em;border: 1px dotted #BBA9A9;}input { font-size: 1.2em;padding: .5em;width: 70%;}table{ width: 100%;}</style>

<div style="margin-top: -1.5em;text-align: center;">
    <a href="/">Home</a>
    » <a href="https://github.com/muaz-khan/WebRTC-Experiment/blob/master/demos/client-side-datachannel.html">Source Code</a>
    » <a href="/chat/">Advance Chat</a>
    » <a href="/docs/how-to-use-rtcdatachannel.html">How to / Guide</a>
</div>
<link rel="prefetch" href="/">

<table>
    <tr>
        <td>
            <input id="from-first-peer" type="text" placeholder="First Peer" disabled>
            <ol id="messages-sent-by-second-peer">
            </ol>
        </td>
        <td>
            <input id="from-second-peer" type="text" placeholder="Second Peer" disabled>
            <ol id="messages-sent-by-first-peer">
            </ol>
        </td>
    </tr>
    <tr style="text-align:center;">
        <td colspan=2>
            <img src="/images/enable-rtcdatachannel.png" width=400 height=150 />            
            <img src="/images/firefox-nightly-preference-for-peerconnection.png" alt="Enable WebRTC on Firefox Nightly" height=150 />
        </td>
    </tr>
    <tr style="text-align:center;">
        <td colspan=2>
            <h2><a href="/docs/rtc-datachannel-for-beginners.html">RTCDataChannel for Beginners</a></h2>
        </td>
    </tr>
</table>

<!-- --------------------------------------------------- -->

<script src="https://bit.ly/RTCPeerConnection-v1-3"></script>

<!-- UI -->
<script>
    var firstPeerTextBox = document.getElementById('from-first-peer');
    var secondPeerTextBox = document.getElementById('from-second-peer');

    var firstPeerOutput = document.getElementById('messages-sent-by-second-peer');
    var secondPeerOutput = document.getElementById('messages-sent-by-first-peer');

    HTMLElement.prototype.addLI = function(message) {
        var li = document.createElement('li');
        li.innerHTML = message;
        this.insertBefore(li, this.childNodes[0]);
    };

    firstPeerTextBox.onchange = function () {
        if (!peer1 || this.disabled) return;

        peer1.sendData(this.value);
		this.value = '';
    };

    secondPeerTextBox.onchange = function () {
        if (!peer2 || this.disabled) return;

        peer2.sendData(this.value);
		this.value = '';
    };
</script>

<!-- First peer: the offerer -->
<script>
    /* "offerSDP" will be used by your participant! */
    var offerSDP, peer1;

    window.onload = create1stPeer;
    function create1stPeer() {
        peer1 = RTCPeerConnection({
            onOfferSDP: function (sdp) {
                console.log('1st peer: offer sdp: ' + sdp);
                offerSDP = sdp;

                /* Offer created: Now start 2nd peer to create its answer SDP */
                setTimeout(create2ndPeer, 400);
            },
            onICE: function (candidate) {
                console.log('1st peer: candidate' + candidate);

                /* 2nd peer should process/add ice candidates sent by 1st peer! */
                peer2 && peer2.addICE({
                    sdpMLineIndex: candidate.sdpMLineIndex,
                    candidate: candidate.candidate
                });
            },
            onChannelOpened: function () {
                firstPeerTextBox.removeAttribute('disabled');
                peer1.sendData('First peer is ready to share text messages with you!');
            },
            onChannelMessage: function (event) {
                firstPeerOutput.addLI(event.data);
            }
        });
    }
</script>

<!-- Second peer: the participant -->
<script>
    var peer2;

    function  create2ndPeer() {
        peer2 = RTCPeerConnection({
            onAnswerSDP: function (sdp) {
                console.log('2nd peer: sdp' + sdp);

                /* 1st peer should complete the handshake using answer SDP provided by 2nd peer! */
                peer1.addAnswerSDP(sdp);
            },
            onICE: function (candidate) {
                console.log('2nd peer: candidate' + candidate);

                /* 1st peer should process/add ice candidates sent by 2nd peer! */
                peer1 && peer1.addICE({
                    sdpMLineIndex: candidate.sdpMLineIndex,
                    candidate: candidate.candidate
                });
            },
            offerSDP: offerSDP,
            onChannelOpened: function () {
                secondPeerTextBox.removeAttribute('disabled');
                peer2.sendData('Second peer is ready to share text messages with you!');
            },
            onChannelMessage: function (event) {
                secondPeerOutput.addLI(event.data);
            }
        });
    }
</script>

<!-- --------------------------------------------------- -->

<div id=pubnub ssl=on></div>
<script src="https://bit.ly/socket-io"></script>
<script src="/dependencies/common.js"></script>