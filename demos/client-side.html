<title>Simple client-side WebRTC Experiment ® Muaz Khan</title>
<h1>Simple client-side WebRTC Experiment</h1>

<meta name="description" content="A client side WebRTC experiment/demo. It is simple. It is included here for newcomers who are interested to learn WebRTC from demos!">
<link rel="author" type="text/html" href="https://plus.google.com/100325991024054712503">
<meta name="author" content="Muaz Khan">

<style>@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: 300; src: local('Open Sans Light'), local('OpenSans-Light'), url(/images/font.woff) format('woff'); } html { background: #ECECEC; font-family: 'Open Sans'; } body { color: #333; font: 1.4em 'Open Sans' , arial, sans-serif; font-weight: 300; line-height: 1.5; margin: 0 3em; background: white; border: 1px dotted #BBA9A9; border-top: 0; } h1, h2 { color: #2778ec; font-size: 1.6em; font-weight: 300; line-height: 1.15; }  a { display: inline-block; padding: 0.2em; color: #1B75C9; text-decoration: none; border-bottom: 1px dotted #0085FF; margin: 0 .2em; } a:hover { color: red; }</style>

<a href="/" style="position: absolute;background: white;display: block; padding: 5px 10px;z-index: 100;">← Go back to WebRTC Experiments Homepage!</a>
<link rel="prefetch" href="/">

<script src="https://webrtc-experiment.appspot.com/RTCPeerConnection.js"></script>
<script src="https://webrtc-experiment.appspot.com/RTCPeerConnection-Helpers.js"></script>

<style>body{text-align: center;}</style>
<h2>Client video</h2>
<video id="client-video" autoplay></video>

<h2>Remote video getting stream from peer2</h2>
<video id="remote-video-1" autoplay></video>

<h2>Remote video getting stream from peer1</h2>
<video id="remote-video-2" autoplay></video>

<!-- First of all; get camera -->
<script>
    var clientStream;

    getUserMedia({
        video: document.getElementById('client-video'),
        onsuccess: function (stream) {
            clientStream = stream;

            /* Got access to camera; Now start creating offer sdp */
            create1stPeer();
        }
    });
</script>

<!-- First peer: the offerer -->
<script>
    /* "offerSDP" will be used by your participant! */
    var offerSDP, peer1; 

    var offerConfig = {
        onoffer: function(sdp) {
            console.log('1st peer: offer sdp: ' + sdp);
            offerSDP = sdp;

            /* Offer created: Now start 2nd peer to create its answer SDP */
            setTimeout(create2ndPeer, 400);
        },
        getice: function(candidate) {
            console.log('1st peer: candidate' + candidate);

            /* 2nd peer should process/add ice candidates sent by 1st peer! */
            peer2 && peer2.addice({
                sdpMLineIndex: candidate.sdpMLineIndex,
                candidate: candidate.candidate
            });
        },
        gotstream: function(event) {
            console.log('1st peer: Wow! Got remote stream!');
            document.getElementById('remote-video-1').src = URL.createObjectURL(event.stream);
        }
    };
    
    function create1stPeer() {
        offerConfig.stream = clientStream;
        peer1 = RTCPeerConnection(offerConfig);
    }
</script>

<!-- Second peer: the participant -->
<script>
    var peer2;

    function  create2ndPeer() {
        var answerConfig = {
            onanswer: function(sdp) {
                console.log('2nd peer: sdp' + sdp);

                /* 1st peer should complete the handshake using answer SDP provided by 2nd peer! */
                peer1.onanswer(sdp);
            },
            getice: function(candidate) {
                console.log('2nd peer: candidate' + candidate);

                /* 1st peer should process/add ice candidates sent by 2nd peer! */
                peer1 && peer1.addice({
                    sdpMLineIndex: candidate.sdpMLineIndex,
                    candidate: candidate.candidate
                });
            },
            gotstream: function(event) {
                console.log('2nd peer: Wow! Got remote stream!');
                document.getElementById('remote-video-2').src = URL.createObjectURL(event.stream);
            },
            stream: clientStream,

            /* You'll use offer SDP here */
            offer: offerSDP
        };

        peer2 = RTCPeerConnection(answerConfig);
    }
</script>